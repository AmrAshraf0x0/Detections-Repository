title: Detect Password Spraying - Multiple Failed Logon Attempts
id:
status: experimental
description: >
    This rule detects potential password spraying attacks by monitoring
    for multiple failed authentication attempts across different accounts.
    Password spraying typically involves attackers attempting a few passwords
    against a large number of accounts, causing failed logons.
    
author: Shunaid Shafique
date: 2024-11-12
references:
    - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4625
    - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4771
    - https://www.sans.org/white-papers/401/
logsource:
    product: windows , Linux/Unix/macOS
    service: security
    category: authentication
    type: failed_login
detection:
    selection:
        - EventCode: 4625  # Failed logon attempt (Windows)
        - EventCode: 4771  # Kerberos Pre-authentication failure (Windows)
        - message: "*Failed password*"  # Failed SSH login attempts (Linux/Unix/macOS)
    filter:
        count:
            field: src_user
            value: 5  # More than 5 failed attempts for distinct user accounts
        timeframe: 3600  # Within the last 60 minutes
    condition: selection and filter
    groupby:
        - src_user  # Group by source user to identify targets of failed attempts
    timeframe: 3600  # 1 hour window for failed attempts
    level: high
    message: "Multiple failed login attempts detected, possible password spraying."
falsepositives:
    - User errors
    - Automated systems with misconfigured credentials
level: high
tags:
    - attack.persistence
    - attack.lateral_movement
    - detection.password_spraying
