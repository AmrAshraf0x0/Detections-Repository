title: Detection of Credential Dumping Tools and Suspicious Processes
id: 123e4567-e89b-12d3-a456-426614174002
status: Experimental
description: |
  Detects the use of credential dumping tools (like Mimikatz, ProcDump) and suspicious PowerShell scripts used for NTLM hash theft.
author: Danish Kumar
date: 2024-11-13
references:
  - https://github.com/eladshamir/Internal-Monologue
  - https://dev.to/tilakupadhyay/credential-dumping-ntlm-hash-detection-and-prevention-2ihn
  - https://www.cyberark.com/resources/threat-research-blog/detecting-pass-the-hash-with-windows-event-viewer

logsource:
  category: process_creation
  product: windows
  sysmon: true

detection:
  selection:
    # Event ID 4688 - Process creation event
    # sysmon EventID: 1                          # Process creation event
    Image|endswith:
      - '\procdump.exe'                  # Known credential dumping tool (ProcDump)
      - '\mimikatz.exe'                  # Known credential dumping tool (Mimikatz)
      - '\powershell.exe'                # PowerShell used in malicious scripts
    CommandLine|contains:
      - '-ma'                            # Monitoring ProcDump with the -ma argument for LSASS memory dumps
      - 'sekurlsa::logonpasswords'        # Mimikatz command for credential dumping
      - 'Invoke-Mimikatz'                 # PowerShell-based Mimikatz invocation
      - 'sekurlsa::pth'                   # Pass-the-Hash (PtH) related Mimikatz invocation
    IntegrityLevel: high                 # Elevated privileges typically needed for credential dumping
  condition: selection

fields:
  - User                             # Identifies the user who executed the command
  - ProcessId                        # Unique process ID for tracking
  - ParentProcessId                  # Parent process ID for process hierarchy
  - Image                            # Path of the executable in process creation events
  - CommandLine                      # Full command line for understanding arguments used in credential dumping
  - Timestamp                        # Event timestamp for timeline reconstruction

level: high
tags:
  - attack.credential-access
  - attack.t1003.001
  - attack.t1003
  - attack.execution

falsepositives:
  - Legitimate administrative use of PowerShell for remote management
  - Tools like ProcDump being used for legitimate debugging purposes
  - Remote desktop or local admin scripts invoking mimikatz via PowerShell (if validated as normal behavior in your environment)

mitre:
  - Tactic: credential-access
  - Technique: T1003.001 (LSASS Memory Dumping)
  - Sub-technique: T1003
  - Technique: T1075 (Pass-the-Hash)
