title: Detect Suspicious Active Setup Registry Modifications
id: detect-active-setup-registry-modification
status: Experimental
description: Detects modifications to Active Setup registry keys, which may indicate persistence mechanisms.
author: Amr Ashraf
logsource:
  category: registry
  product: windows
detection:
  selection:
    EventID: 4657  # Registry modification event
    ObjectName|contains: 
      - 'HKLM\Software\Microsoft\Active Setup\Installed Components\'
      - 'HKCU\Software\Microsoft\Active Setup\Installed Components\'
    ObjectValueName: 'StubPath'
  condition: selection
fields:
  - EventID
  - RegistryKey
  - RegistryValueName
  - NewValue
  - User
  - ComputerName
level: high
tags:
  - attack.persistence
  - attack.privilege_escalation
  - t1547.009
falsepositives:
  - Legitimate software installations or updates
  - Administrative scripts modifying Active Setup
