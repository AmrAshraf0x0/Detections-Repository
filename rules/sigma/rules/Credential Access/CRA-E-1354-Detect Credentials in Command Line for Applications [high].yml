title: Detect Credentials in Command Line for Applications Windows
id: detect-credentials-in-command-line
status: Experimental
description: Detects suspicious use of credentials in the command line for common applications like FTP, SSH, and MySQL, which may indicate credential leakage or misuse.
author: Amr Ashraf
logsource:
  category: process_creation
  product: windows
  service: security
detection:
  selection:
    - NewProcessName|endswith:
        - '\ftp.exe'
        - '\ssh.exe'
        - '\scp.exe'
        - '\mysql.exe'
        - '\psql.exe'
        - '\wget.exe'
        - '\curl.exe'
        - '\nc.exe'
      CommandLine|contains:
        - ' -p'
        - ' -pw'
        - ' --password'
        - ' --pass'
        - ' --key'
        - ' -key'
        - ' --token'
        - ' -token'
  filter:
    - CommandLine|contains:
        - '--update'
        - '--help'
        - '--version'
        - '-v'
  condition: selection and not filter
fields:
  - Image
  - CommandLine
  - ParentImage
  - User
  - Hostname
  - ProcessId
  - ParentProcessId
level: high
tags:
  - attack.credential_access
  - t1552.003
  - attack.unsecured_credentials
falsepositives:
  - Legitimate administrative or troubleshooting use.
  - Automated scripts using credentials in the command line (e.g., backup jobs).
