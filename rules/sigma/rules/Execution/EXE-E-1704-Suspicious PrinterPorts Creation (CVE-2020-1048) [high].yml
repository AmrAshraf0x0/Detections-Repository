title: Suspicious PrinterPorts Creation (CVE-2020-1048)
status: Developed
description: Detects new commands that add new printer port which point to suspicious file
references:
    - https://windows-internals.com/printdemon-cve-2020-1048/
author: Amr Ashraf
date: 2024-12-24
tags:
    - attack.persistence
    - attack.execution
    - attack.t1059.001
    - cve.2020-1048
    - detection.emerging-threats
logsource:
    category: process_creation
    product: windows
detection:
    selection1:
        CommandLine|contains: 'Add-PrinterPort -Name'
        EventID: 4688
    selection2:
        CommandLine|contains:
            - '.exe'
            - '.dll'
            - '.bat'
    selection3:
        CommandLine|contains: 'Generic / Text Only'
    condition: (selection1 and selection2) or selection3
VQL: |
    LET ID_1704 = (
        (CommandLine =~ "(?=.*Add-PrinterPort -Name)" AND CommandLine =~ "(?=.*\\.exe|.*\\.dll|.*\\.bat)") OR
        CommandLine =~ "(?=.*Generic / Text Only)"
    )
falsepositives:
    - New printer port install on host
level: high
