title: Detect Executables or DLLs Running from suspicious directories
description: Detects executables or DLLs running from TEMP, Public, directly from the ProgramData directory, from the Recycle Bin, or from the System Volume Information directory, which may indicate malicious activity.
status: Developed
author: Amr Ashraf
date: 2024/09/23
logsource:
  category: process_creation
  product: windows
detection:
  pro_cre:
    EventID: 4688
  selection_temp_exe:
    NewProcessName|contains:
      - '\Temp\'
      - '\Users\Public\'
      - '\System Volume Information\'
      - '\$Recycle.Bin\'
  selection_temp_dll:
    NewProcessName|endswith:
      - 'rundll32.exe'
      - 'regsvr32.exe'
    CommandLine|contains:
      - '\AppData\Local\Temp\'
      - '\Temp\'
      - '\Users\Public\'
      - '\ProgramData\'
  condition: pro_cre and (selection_temp_exe or selection_temp_dll)
fields:
  - CommandLine
  - Image
  - ParentImage
  - User
falsepositives:
  - Legitimate software updates or installers may run from these directories
level: high
tags:
  - attack.execution
  - attack.t1059
