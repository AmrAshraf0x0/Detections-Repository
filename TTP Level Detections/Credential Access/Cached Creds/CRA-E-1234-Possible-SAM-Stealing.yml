title: Suspicious Access to SAM File or Registry for Credential Dumping
description: Detects access to the SAM file or registry path associated with storing local user credentials. Attackers may attempt to access these files directly, through volume shadow copies, or through the registry to extract password hashes.
status: Developed
author: Amr Ashraf
date: 2024/11/10
logsource:
  category: file_access
  product: windows
  definition:
    - source: Security
detection:
  selection_file_direct:
    EventID: 4663
    TargetFilename: 'C:\\Windows\\System32\\config\\SAM'
  selection_file_shadow:
    EventID: 4663
    TargetFilename: '\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*\\Windows\\System32\\config\\SAM'
  selection_registry_direct:
    EventID: 4656
    TargetObject: 'HKLM\\SAM'
  selection_registry_shadow:
    EventID: 4656
    TargetObject: '\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*\\Windows\\System32\\config\\SAM'
  condition: selection_file_direct or selection_file_shadow or selection_registry_direct or selection_registry_shadow
fields:
  - TargetFilename
  - TargetObject
  - ProcessName
  - AccountName
  - AccessMask
falsepositives:
  - Legitimate access by backup software or system processes to SAM files or registry keys for backup purposes
level: high
tags:
  - attack.credential_access
  - attack.t1003.2
