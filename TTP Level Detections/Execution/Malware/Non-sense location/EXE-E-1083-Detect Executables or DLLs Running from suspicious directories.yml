title: Detect Executables or DLLs Running from suspicious directories
description: Detects executables or DLLs running from TEMP, Public, directly from the ProgramData directory, from the Recycle Bin, or from the System Volume Information directory, which may indicate malicious activity.
status: Developed
author: Amr Ashraf
date: 2024/09/23
logsource:
  category: process_creation
  product: windows
detection:
  selection_temp_exe:
    NewProcessName|contains:
      - '\AppData\Local\Temp\'
      - '\Temp\'
  selection_temp_dll:
    NewProcessName|endswith:
      - 'rundll32.exe'
      - 'regsvr32.exe'
    CommandLine|contains:
      - '\AppData\Local\Temp\'
      - '\Temp\'
  selection_public_exe:
    NewProcessName|contains:
      - '\Users\Public\'
  selection_public_dll:
    NewProcessName|endswith:
      - 'rundll32.exe'
      - 'regsvr32.exe'
    CommandLine|contains:
      - '\Users\Public\'
  selection_programdata_exe:
    NewProcessName|endswith:
      - '\ProgramData\*.exe'
  selection_programdata_dll:
    NewProcessName|endswith:
      - 'rundll32.exe'
      - 'regsvr32.exe'
    CommandLine|contains:
      - '\ProgramData\'
  selection_recyclebin_exe:
    NewProcessName|contains:
      - '\$Recycle.Bin\'
  selection_recyclebin_dll:
    NewProcessName|endswith:
      - 'rundll32.exe'
      - 'regsvr32.exe'
    CommandLine|contains:
      - '\$Recycle.Bin\'
  selection_systemvolumeinfo_exe:
    NewProcessName|contains:
      - '\System Volume Information\'
  selection_systemvolumeinfo_dll:
    NewProcessName|endswith:
      - 'rundll32.exe'
      - 'regsvr32.exe'
    CommandLine|contains:
      - '\System Volume Information\'
  condition: selection_temp_exe or selection_temp_dll or selection_public_exe or selection_public_dll or selection_programdata_exe or selection_programdata_dll or selection_recyclebin_exe or selection_recyclebin_dll or selection_systemvolumeinfo_exe or selection_systemvolumeinfo_dll
fields:
  - CommandLine
  - Image
  - ParentImage
  - User
falsepositives:
  - Legitimate software updates or installers may run from these directories
level: high
tags:
  - attack.execution
  - attack.t1059
