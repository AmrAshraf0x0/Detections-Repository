title: DIS-006-E-000-0005-Windows Test-NetConnection Common Ports
id: dis-006-e-000-0005
status: experimental
description: Detects Test-NetConnection PowerShell cmdlet usage for common service port discovery
references:
    - https://attack.mitre.org/techniques/T1046/
author: HexaPrime Detection Team
date: 2025/12/13
tags:
    - attack.T1046
    - attack.discovery
logsource:
    product: windows
    category: process_creation
detection:
    selection:
        Image|endswith:
            - '\powershell.exe'
            - '\pwsh.exe'
        CommandLine|contains|all:
            - 'Test-NetConnection'
            - '-Port'
        CommandLine|contains:
            - '22'    # SSH
            - '23'    # Telnet
            - '53'    # DNS
            - '80'    # HTTP
            - '135'   # RPC
            - '139'   # NetBIOS
            - '443'   # HTTPS
            - '445'   # SMB
            - '993'   # IMAPS
            - '995'   # POP3S
            - '1433'  # SQL Server
            - '3389'  # RDP
            - '5985'  # WinRM HTTP
            - '5986'  # WinRM HTTPS
    condition: selection
falsepositives:
    - Network troubleshooting scripts
    - Connectivity testing
    - Service monitoring tools
level: low