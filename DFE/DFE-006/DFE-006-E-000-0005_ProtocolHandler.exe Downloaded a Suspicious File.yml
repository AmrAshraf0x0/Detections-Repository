title: ProtocolHandler.exe Downloaded a Suspicious File - DFE-006-E-000-0005
id: DFE-006-E-000-0005
status: experimental
description: |
  Detection Description:
  Detects ProtocolHandler.exe being used to retrieve content from an external URL, potentially downloading a payload.
  
  Status:
  experimental
  
  Threat Mapping:
  MITRE ATT&CK Technique(s): T1218 - Signed Binary Proxy Execution; T1105 - Ingress Tool Transfer
  Kill Chain Phase: Defense Evasion
  
  Data Sources:
  MITRE Data Source: Process Creation
  Product targeted by the Rule: Windows Servers (Sysmon)
  Service in the product that provides the log: Sysmon
  
  Detection Logic:
  Sysmon process creation (EventID 1) where ProtocolHandler.exe executes with an HTTP(S) URL and the URL suggests an executable/script/archive payload.
  
  False Positive Considerations:
  Software updaters or enterprise tools using ProtocolHandler with URLs.
  
  Severity and Risk Rating:
  Severity Level: high
  
  References:
  - https://attack.mitre.org/techniques/T1218/
  - https://attack.mitre.org/techniques/T1105/
  
  Author:
  HXP Detection team
  
  Use Case Sheet Details:
  - L3 use cases per L2: 35
  - L1 Use Case Name: Defence Evasion
  - L1 Use Case Identifier: DFE
  - L2 Use Case Name: Signed Binary Proxy Execution (LOLBins)
  - L2 Use Case Identifier: DFE-006
  - Rule Identifier: DFE-006-E-000-0005
  - Technical Use Case Name: ProtocolHandler.exe Downloaded a Suspicious File
  - Use Case Description: 
  - Log source type: Windows Servers
  - Detection Technology: SIEM
  - Scope: All assets
author: HXP Detection team
date: 2025-12-13
references:
  - https://attack.mitre.org/techniques/T1218/
  - https://attack.mitre.org/techniques/T1105/
logsource:
  category: process_creation
  product: windows
  service: sysmon
detection:
  selection:
    EventID: 1
    Image|endswith: '\ProtocolHandler.exe'
    CommandLine|contains:
      - 'http://'
      - 'https://'
  suspicious_ext:
    CommandLine|contains:
      - '.exe'
      - '.dll'
      - '.ps1'
      - '.bat'
      - '.cmd'
      - '.vbs'
      - '.js'
      - '.hta'
      - '.zip'
      - '.rar'
      - '.7z'
      - '.iso'
  condition: selection and suspicious_ext
falsepositives:
  - Legitimate installers/updaters using ProtocolHandler URLs
level: high
tags:
  - attack.defense_evasion
  - attack.t1218
  - attack.t1105
